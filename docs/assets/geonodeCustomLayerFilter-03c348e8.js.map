{"version":3,"file":"geonodeCustomLayerFilter-03c348e8.js","sources":["../../components/core/geonodeCustomLayerFilter/uniqueValues.js","../../components/core/helper/testCors.js","../../components/core/geonodeCustomLayerFilter/geonodeCustomLayerFilter.js"],"sourcesContent":["\n  const getUniqueValues = function(filterName, baseurl, layername) {\n\n    console.log(filterName, baseurl, layername);\n\n   const p = fetch(`${baseurl}/wps?service=WPS&outputFormat=json`, {\n      \"headers\": {\n        \"accept\": \"application/json\",\n        \"accept-language\": \"de-DE,de;q=0.5\",\n        \"content-type\": \"application/xml\",\n      },\n      \"referrer\": \"https://geoserver.dainst.org/catalogue/\",\n      \"body\": `\n      <wps:Execute xmlns:wps=\"http://www.opengis.net/wps/1.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" version=\"1.0.0\" service=\"WPS\" xsi:schemaLocation=\"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd\">\n        <ows:Identifier xmlns:ows=\"http://www.opengis.net/ows/1.1\">gs:PagedUnique</ows:Identifier>\n        <wps:DataInputs>\n          <wps:Input>\n            <ows:Identifier xmlns:ows=\"http://www.opengis.net/ows/1.1\">features</ows:Identifier>\n            <ows:Title xmlns:ows=\"http://www.opengis.net/ows/1.1\">features</ows:Title>\n            <wps:Data />\n            <wps:Reference xmlns:xlink=\"http://www.w3.org/1999/xlink\" mimeType=\"text/xml\" xlink:href=\"http://geoserver/wfs\" method=\"POST\">\n              <wps:Body>\n                <wfs:GetFeature xmlns:wfs=\"http://www.opengis.net/wfs\" service=\"WFS\" version=\"1.0.0\">\n                  <wfs:Query typeName=\"${layername}\">\n                    <ogc:SortBy xmlns:ogc=\"http://www.opengis.net/ogc\">\n                      <ogc:SortProperty>\n                        <ogc:PropertyName>${filterName}</ogc:PropertyName>\n                      </ogc:SortProperty>\n                    </ogc:SortBy>\n                  </wfs:Query>\n                </wfs:GetFeature>\n              </wps:Body>\n            </wps:Reference>\n          </wps:Input>\n          <wps:Input>\n            <ows:Identifier xmlns:ows=\"http://www.opengis.net/ows/1.1\">fieldName</ows:Identifier>\n            <ows:Title xmlns:ows=\"http://www.opengis.net/ows/1.1\">fieldName</ows:Title>\n            <wps:Data>\n              <wps:LiteralData>${filterName}</wps:LiteralData>\n            </wps:Data>\n          </wps:Input>\n          <wps:Input>\n            <ows:Identifier xmlns:ows=\"http://www.opengis.net/ows/1.1\">maxFeatures</ows:Identifier>\n            <ows:Title xmlns:ows=\"http://www.opengis.net/ows/1.1\">maxFeatures</ows:Title>\n            <wps:Data>\n              <wps:LiteralData>20</wps:LiteralData>\n            </wps:Data>\n          </wps:Input>\n          <wps:Input>\n            <ows:Identifier xmlns:ows=\"http://www.opengis.net/ows/1.1\">startIndex</ows:Identifier>\n            <ows:Title xmlns:ows=\"http://www.opengis.net/ows/1.1\">startIndex</ows:Title>\n            <wps:Data>\n              <wps:LiteralData>0</wps:LiteralData>\n            </wps:Data>\n          </wps:Input>\n        </wps:DataInputs>\n        <wps:ResponseForm>\n          <wps:RawDataOutput mimeType=\"application/json\">\n            <ows:Identifier xmlns:ows=\"http://www.opengis.net/ows/1.1\">result</ows:Identifier>\n          </wps:RawDataOutput>\n        </wps:ResponseForm>\n      </wps:Execute>\n      `,\n      \"method\": \"POST\"\n    })\n    .then(response => response.json())\n    .catch(error => {\n      console.error('Error:', error);\n    });\n\n    return p;\n\n  };\n  \n  export { getUniqueValues };\n  ","// corsTestModule.js\nasync function testCORS(url) {\n    // Helper function to test a fetch call\n    async function testFetch(url, options) {\n      try {\n        const response = await fetch(url, options);\n        if (response.ok) {\n          return { success: true, status: response.status };\n        } else {\n          return { success: false, status: response.status, error: 'Response not OK' };\n        }\n      } catch (error) {\n        return { success: false, error: error.message };\n      }\n    }\n  \n    // Test GET request\n    const getResult = await testFetch(url, { method: 'GET' });\n  \n    // Test POST request\n    const postResult = await testFetch(url, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ test: 'data' })\n    });\n  \n    return { getResult, postResult };\n  }\n  \n  export { testCORS };\n  ","import { countEnabledPlugins, getEnabledPluginNames, loadPlugins } from '../../../pluginLoader'\nimport { emitCustomEvent, renderMarkupAndSetPluginReady } from '../../core/helper.js'\n\nimport Alpine from 'alpinejs';\nimport feather from 'feather-icons';\nimport { getUniqueValues } from './uniqueValues.js';\nimport { slugify } from '../../core/helper.js';\nimport { testCORS } from '../../core/helper/testCors';\n\nconst createOffCanvasMarkup = () => {\n\n  let filterOffcanvas = `\n    <div \n        class=\"position-absolute start-0 top-0 bg-white h-100 w-40 p-3 shadow z-2 overflow-auto\" \n        x-transition tabindex=\"-1\" \n        id=\"filterOffcanvas\" \n        aria-labelledby=\"filterOffcanvasLabel\"\n        x-show=\"$store.geonodeCustomLayerFilter.componentIsActive\">\n      <div class=\"offcanvas-header\">\n        <h5 class=\"offcanvas-title\" id=\"filterOffcanvasLabel\" x-text=\"'Filter: ' + $store.geonodeCustomLayerFilter.currentLayerName\">Filter</h5>\n        <button type=\"button\" class=\"btn-close text-reset\" data-bs-dismiss=\"offcanvas\" aria-label=\"Close\" @click=\"$store.geonodeCustomLayerFilter.closeComponent;\"></button>\n      </div>\n\n      <div class=\"offcanvas-body\">\n\n        <!-- Filter content -->\n\n        <div class=\"formContent\">  </div>\n            \n            <template class=\"formRow\">\n                <div class=\"row mt-2 gx-1 mx-0\" x-id=\"['filter-select']\" :data-id=\"$id('filter-select')\">\n                    <div class=\"col-4\">\n                        <select class=\"form-select form-select-sm name\" x-on:change=\"$store.geonodeCustomLayerFilter.updateaOnNameSelect($event.target)\">\n                            <option value=\"-\" x-text=\"'select'\" class=\"text-secondary\"></option>\n                            <template x-for=\"option in $store.geonodeCustomLayerFilter.visibleAttributes()\">\n                                <option :value=\"option\" x-text=\"option\"></option>\n                            </template>\n                        </select>\n                    </div>\n                    <div class=\"col-2\">\n                        <select class=\"form-select form-select-sm operator\" aria-label=\"Default select example\" x-on:change=\"$store.geonodeCustomLayerFilter.updateallFormValues()\" disabled>\n                            <option value=\"=\">is</option>\n                            <option value=\"<>\">is not</option>\n                        </select>\n                    </div>\n                    <div class=\"col-5\">\n                        <select class=\"form-select form-select-sm value\" aria-label=\"Default select example\" x-on:change=\"$store.geonodeCustomLayerFilter.updateallFormValues()\" disabled>\n\n                        </select>\n                    </div>\n                    <div class=\"col-1\">\n                        <button class=\"btn btn-light btn-sm\" x-tooltip.placement.top=\"'remove filter'\" @click=\"$store.geonodeCustomLayerFilter.removeItem($id('filter-select'))\">\n                            <i data-feather=\"trash-2\" class=\"size-16\"></i>\n                        </button>\n                    </div>\n                </div>\n            </template>\n    \n                    <pre x-data x-html=\"JSON.stringify($store.geonodeCustomLayerFilter.allFormValues)\" class=\"bg-light mt-3 d-none\"></pre></div>\n\n\n            <!-- Filter content -->\n        </div>\n  </div>`;\n\n  document.getElementById('map').insertAdjacentHTML('afterend', filterOffcanvas);\n}\n\nconst createFormDom = (id) => {\n    return `\n      <div class=\"layerForm\" x-id=\"['operator-input']\">\n        \n\n          <div id=\"${id}\" x-show=\"'${id}' == $store.geonodeCustomLayerFilter.currentFormId\">\n\n          <p class=\"alert alert-warning mt-5\" x-cloak role=\"alert\" x-text=\"$store.geonodeCustomLayerFilter.corsInformation\" x-show=\"!$store.geonodeCustomLayerFilter.corsTestpassed\"></p>\n\n            <div x-show=\"$store.geonodeCustomLayerFilter.corsTestpassed\">  \n                <div class=\"form-check form-switch mt-3\">\n                <input class=\"form-check-input or_operator_selector\" :id=\"$id('operator-input')\" type=\"checkbox\"  x-on:change=\"$store.geonodeCustomLayerFilter.updateallFormValues()\">\n                <label class=\"form-check-label\" :for=\"$id('operator-input')\">AND / OR</label>\n                </div>\n\n                <div x-data>\n                    <button x-data\n                    class=\"btn btn-secondary btn-sm mt-3 addItem\"\n                    @click=\"$store.geonodeCustomLayerFilter.addItem('${id}')\">add filter</button>\n\n                    <button x-data\n                        class=\"btn btn-secondary btn-sm mt-3 submitFilter\"\n                        @click=\"$store.geonodeCustomLayerFilter.submitFilterForm()\"\n                        :disabled=\"$store.geonodeCustomLayerFilter.hasActiveFilters()\">filter layer</button>\n\n                <button x-data\n                    class=\"btn btn-secondary btn-sm mt-3 submitFilter\"\n                    @click=\"$store.geonodeCustomLayerFilter.clearFilterForm()\" \n                    :disabled=\"$store.geonodeCustomLayerFilter.hasActiveFilters()\">clear filter</button>\n\n                </div>\n            </div>\n\n          </div>\n      </div>\n    `;\n  };\n\n\n\n\nconst initialize = () => {\n\n  Alpine.store('geonodeCustomLayerFilter', {\n    componentIsActive: false,\n    currentLayerName: \"\",\n    currentValueSelect: null,\n    url:\"\",\n    corsInformation: \"\",\n    nameSelectOptions: [],\n    allFormValues: {},\n    enabledPlugins: getEnabledPluginNames(),\n    closeComponent: function (){\n      this.componentIsActive = false;\n      console.log(this.componentIsActive)\n      emitCustomEvent('geonodeCustomLayerFilterClosed', {});\n    },\n    submitFilterForm: function(){\n        const currentFormFilter = this.allFormValues[this.currentFormId];\n        const activatedComponents = Alpine.store('pluginStatus').registeredPluginNames;\n        this.layer.updateParams({ 'CQL_FILTER': currentFormFilter });\n\n        if (this.enabledPlugins.includes('layerPanel')){\n          Alpine.store('layerPanel').activeFilters.push(this.currentLayerName);\n        }\n    },\n    clearFilterForm: function(){\n        this.allFormValues[this.currentFormId] = \"\";\n        const template = document.querySelector('#'+this.currentFormId); \n        const contentRows = template.querySelectorAll('.row');\n\n        // Iterate over the NodeList and remove each element\n        contentRows.forEach(row => {\n            row.remove();\n        });\n\n        this.layer.updateParams({ 'CQL_FILTER': '(1=1)' });\n\n        if (this.enabledPlugins.includes('layerPanel')){\n          Alpine.store('layerPanel').activeFilters = Alpine.store('layerPanel').activeFilters.filter((item) => {\n            return item !== this.currentLayerName;\n          });\n        }\n\n\n    },\n    hasActiveFilters: function(){\n        const currentFormFilter = this.allFormValues[this.currentFormId];\n        if (currentFormFilter){\n            return currentFormFilter.length == 0;\n        }\n\n        return true;\n    },\n    visibleAttributes: function() {\n       return this.nameSelectOptions.filter(option => option.visible).map(option => option.attribute);\n    },\n    updateaOnNameSelect: function(target) {\n     const filterName = target.value;\n     const hasValue = filterName.trim() !== '' && filterName.trim() !== '-';\n     const parentRow = target.closest('.row');\n     const operatorSelect = parentRow.querySelector('.operator');\n     const valueSelect = parentRow.querySelector('.value');\n     this.currentValueSelect = valueSelect;\n     \n     // Enable or disable the selects based on the input value\n     operatorSelect.disabled = !hasValue;\n     valueSelect.disabled = !hasValue;\n\n     getUniqueValues(filterName, this.url, this.alternate)\n     .then(data => {\n        this.currentValueSelect.innerHTML = \"\";\n        data.values.forEach(value => {\n            if (value !== \"\") {\n            const option = document.createElement('option');\n            option.value = value;\n            option.textContent = value;\n            this.currentValueSelect.appendChild(option);\n            this.currentValueSelect.classList.add('updated');\n            }\n        });\n\n        this.updateallFormValues();\n\n     })\n     .catch(error => console.error('Error:', error));\n\n   },\n    runCorsTest: async function(){\n            const url = this.url; \n            const results = await testCORS(url);\n            console.log('CORS Test Results:', results);\n            this.corsTestpassed = results['postResult']['success']\n            this.corsInformation =\"Server does not support POST requests\"\n\n            if (this.corsTestpassed ){\n                this.corsInformation =\"Test passed\"\n            }\n    },\n    updateallFormValues: function() {\n     const currentFormId = this.currentFormId;\n     const currentForm = document.querySelector(`#${currentFormId}`);\n     const rows = document.querySelectorAll(`#${currentFormId} .row`);\n     var joinStr = currentForm.getElementsByClassName('or_operator_selector')[0];\n\n\n     joinStr = joinStr.checked ? ' OR ' : ' AND ';\n     let concatenatedValues = '';\n\n     rows.forEach(row => {\n      const nameElement = row.querySelector('.name');\n      const operatorElement = row.querySelector('.operator');\n      const valueElement = row.querySelector('.value');\n    \n      const name = nameElement ? nameElement.value : null;\n      const operator = operatorElement ? operatorElement.value : null;\n      const value = valueElement ? valueElement.value : null;\n    \n      const hasNameValue = name && name.trim() !== '' && name.trim() !== '-';\n    \n      if (hasNameValue && operator && value) {\n        concatenatedValues += `(\"${name}\"${operator}'${value}')${joinStr}`;\n      }\n    });\n\n     const joinStrLength = joinStr.length;\n\n    if (concatenatedValues) {\n        // Remove the last join string\n        concatenatedValues = concatenatedValues.slice(0, -joinStrLength);\n    }\n\n     this.allFormValues[currentFormId] = concatenatedValues;\n   },\n\n    currentFormId: \"\",\n    handlelayerChange: function() {\n     const content = document.querySelector('.formContent');\n     const template = createFormDom(this.currentFormId);\n     const form_exists = document.querySelector('#'+this.currentFormId);\n\n     if (!form_exists){\n       content.insertAdjacentHTML('beforeend', template);\n     } else {\n       console.log(\"Form exists for:\", this.currentFormId);\n     }\n   },\n\n    removeItem: function(id){\n      const el = document.querySelector(`[data-id=\"${id}\"]`);\n      console.log(el);\n      el.remove();\n      \n      this.updateallFormValues();\n      this.submitFilterForm();\n\n      if (this.hasActiveFilters() == true){\n        this.clearFilterForm();\n      }\n\n    },\n    addItem: function(id) {\n\n       const content = document.querySelector('#'+id);\n       const btn = content.querySelector('.addItem')\n       const template = document.querySelector('template.formRow'); \n       if (content && template) {\n         btn.insertAdjacentHTML('beforebegin', template.innerHTML);\n         feather.replace();\n       }\n    }\n\n    });\n\n    // Catch the custom event and execute a function to update the legend\n    document.addEventListener('filterPushed', function (event) {\n      console.debug('Custom event \"filterPushed\" caught in filterLayer/filterLayer.js');\n      const geonodeCustomLayerFilter = Alpine.store('geonodeCustomLayerFilter');\n      \n      const layer = event.detail.instance;\n      const l_dataset = layer.dataset;\n\n      geonodeCustomLayerFilter.layer = layer;\n      geonodeCustomLayerFilter.alternate = l_dataset.alternate;\n      geonodeCustomLayerFilter.currentLayerName = layer.mapName;\n      geonodeCustomLayerFilter.url = layer.getUrl();\n      geonodeCustomLayerFilter.nameSelectOptions = l_dataset.attribute_set;\n      geonodeCustomLayerFilter.currentFormId = slugify(layer.mapName);\n      geonodeCustomLayerFilter.handlelayerChange();\n\n      geonodeCustomLayerFilter.componentIsActive = true;\n      geonodeCustomLayerFilter.runCorsTest();\n\n    });\n\n  // [function name that creates the DOM Element, Element to check for presence}\n  const domElementsToCreate = [\n      [createOffCanvasMarkup, '#filterOffcanvas'],\n  ]\n\n  // this function tirggers the rendering and tells main.js that initialization is finished\n  renderMarkupAndSetPluginReady(domElementsToCreate)\n\n};\n\n\nexport { initialize };"],"names":["getUniqueValues","filterName","baseurl","layername","response","error","testCORS","url","testFetch","options","getResult","postResult","createOffCanvasMarkup","filterOffcanvas","createFormDom","id","initialize","Alpine","getEnabledPluginNames","emitCustomEvent","currentFormFilter","row","item","option","target","hasValue","parentRow","operatorSelect","valueSelect","data","value","results","currentFormId","currentForm","rows","joinStr","concatenatedValues","nameElement","operatorElement","valueElement","name","operator","joinStrLength","content","template","el","btn","feather","event","geonodeCustomLayerFilter","layer","l_dataset","slugify","renderMarkupAndSetPluginReady"],"mappings":"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"}