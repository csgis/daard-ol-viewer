{"version":3,"file":"mapMarker-00444ba7.js","sources":["../../components/core/mapMarker/mapMarker.js"],"sourcesContent":["// import './mapMarker.css'\n\nimport { Icon, Style } from 'ol/style';\nimport { boundingExtent, extend } from 'ol/extent';\nimport {map, view} from '../mapSetup/mapSetup.js';\n\nimport Alpine from 'alpinejs';\nimport { Feature } from 'ol';\nimport { Point } from 'ol/geom';\nimport feather from 'feather-icons';\nimport { vector } from '../mapSetup/mapSetup.js';\n\nconst createPinStyle = () => {\n    // Get the SVG content from Feather Icons\n    const svg = feather.icons['map-pin'].toSvg({ \n        class: 'custom-pin', \n        width: 36, \n        height: 36,\n        stroke: 'black',\n        fill: 'yellow'\n    });\n\n    // Convert SVG string to an icon style with an adjusted anchor\n    return new Style({\n        image: new Icon({\n            imgSize: [36, 36],\n            anchor: [0.5, 1], // Anchor at the bottom center of the icon\n            anchorXUnits: 'fraction',\n            anchorYUnits: 'fraction',\n            src: 'data:image/svg+xml;utf8,' + encodeURIComponent(svg)\n        })\n    });\n};\n\nconst convertVhToPixels = (vh) => {\n    const numericVh = parseFloat(vh.replace(/vh$/, ''));\n    return numericVh * document.documentElement.clientHeight / 100;\n}\n\nconst createMarkers = (coordinates, fitView = false, moveCenterLeft = false, moveCenterRight = false, bottomPadding) => {\n\n    vector.getSource().clear();\n    const pinStyle = createPinStyle();\n    let extents = [];\n\n    coordinates.forEach(coord => {\n        const marker = new Feature({\n            geometry: new Point(coord)\n        });\n        marker.setStyle(pinStyle);\n        vector.getSource().addFeature(marker);\n        extents.push(marker.getGeometry().getExtent());\n    });\n\n    if (fitView) {\n        if (extents.length === 1) {\n            const singlePinLocation = coordinates[0];\n            let finalCenter = singlePinLocation; \n    \n            const currentZoomLevel = view.getZoom()\n            if (moveCenterLeft || moveCenterRight) {\n                const zoomLevel = currentZoomLevel;\n                finalCenter = calculateFinalCenter(map, singlePinLocation, zoomLevel, moveCenterLeft, moveCenterRight);\n            }\n    \n            view.animate({\n                center: finalCenter,\n                zoom: currentZoomLevel,\n                duration: 500\n            });\n        } else if (extents.length > 1) {\n            // Check if bottomPadding is a string and includes 'vh', then convert it\n            const attributeTableHeightPx = typeof bottomPadding === 'string' && bottomPadding.includes('vh') \n                                        ? convertVhToPixels(bottomPadding) \n                                        : bottomPadding;   \n            bottomPadding = attributeTableHeightPx + 150;                          \n\n            const boundingBox = boundingExtent(extents);\n            const padding = [100, 100, bottomPadding, 100];\n            view.fit(boundingBox, { padding: padding, duration: 500 });\n        }\n    }\n};\n\n\nfunction calculateFinalCenter(map, pinLocation, zoomLevel, moveCenterLeft, moveCenterRight) {\n    const size = map.getSize();\n    const view = map.getView();\n    view.setZoom(zoomLevel); // Temporarily set the zoom level for calculation\n    const resolution = view.getResolutionForZoom(zoomLevel);\n\n    const shiftX = size[0] / 4 * resolution;\n    const adjustedLocation = moveCenterRight \n        ? [pinLocation[0] - shiftX, pinLocation[1]] \n        : [pinLocation[0] + shiftX, pinLocation[1]];\n\n    view.setZoom(view.getZoom()); // Reset the zoom level to current\n    return adjustedLocation;\n}\n\n\n\n\nconst deleteMarkers = () => {\n    vector.getSource().clear();\n};\n\nconst initialize = async (coordinates) => {\n    Alpine.store('mapMarker', {\n        markers: coordinates,\n        addMarkers: function(fitView = false, moveCenterLeft, moveCenterRight, bottomPadding) {\n            createMarkers(this.markers, fitView, moveCenterLeft, moveCenterRight, bottomPadding);\n        },\n        removeMarkers: function() {\n            deleteMarkers();\n        }\n    });\n\n    // Catch the custom event and execute a function to update the legend\n    document.addEventListener('addMapPins', function (event) {\n        console.debug('Custom event \"addMapPins\" caught in mapMarker/mapMarker.js');\n        const pin_coordinates = event.detail.pin_coordinates;\n        const fitView = event.detail.fitView || false;\n        const moveCenterLeft = event.detail.moveCenterLeft || false;\n        const moveCenterRight = event.detail.moveCenterRight || false;\n        const bottomPadding = event.detail.bottomPadding || 600;\n\n       console.log(\"Event padding\", bottomPadding)\n\n        Alpine.store('mapMarker').markers = pin_coordinates;\n        Alpine.store('mapMarker').addMarkers(fitView, moveCenterLeft, moveCenterRight, bottomPadding);\n      });\n\n\n          // Catch the custom event and execute a function to update the legend\n    document.addEventListener('deleteMapPins', function (event) {\n        console.debug('Custom event \"deleteMapPins\" caught in mapMarker/mapMarker.js');\n        Alpine.store('mapMarker').removeMarkers();\n      });\n\n\n      Alpine.store('pluginStatus').increasePluginLoadingStatus();\n\n\n\n};\n\nexport { initialize };\n"],"names":["createPinStyle","svg","feather","Style","Icon","convertVhToPixels","vh","createMarkers","coordinates","fitView","moveCenterLeft","moveCenterRight","bottomPadding","vector","pinStyle","extents","coord","marker","Feature","Point","singlePinLocation","finalCenter","currentZoomLevel","view","calculateFinalCenter","map","boundingBox","boundingExtent","padding","pinLocation","zoomLevel","size","resolution","shiftX","adjustedLocation","deleteMarkers","initialize","Alpine","event","pin_coordinates"],"mappings":"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"}