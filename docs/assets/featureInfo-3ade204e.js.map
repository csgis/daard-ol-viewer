{"version":3,"file":"featureInfo-3ade204e.js","sources":["../../components/contrib/featureInfoDAARD/featureInfo.js"],"sourcesContent":["import './featureInfo.css';\n\nimport { buildLink, renderMarkupAndSetPluginReady } from '../../core/helper.js'\nimport { featureLayersGroup, map, view } from '../../core/mapSetup/mapSetup.js';\n\nimport Alpine from 'alpinejs';\nimport { decorateValue } from '../../core/contentDecorator/contentDecorator.js';\nimport { emitCustomEvent } from '../../core/helper.js';\nimport { generateColoredSvg } from './bonesSvgGenerator.js';\n\nconst createFeatureInfoOffCanvasMarkup = () => {\n  const featureInfoOffcanvas = `\n  <div id=\"featureInfoOffcanvas\" class=\"position-absolute end-0 top-0 bg-white h-100 w-50 p-3 shadow overflow-scroll\" tabindex=\"-1\" aria-labelledby=\"featuresOffcanvasLabel\" x-show=\"$store.featureInfoStore.showOffCanvas\" style=\"z-index:1001\" x-transition>\n  <!-- Offcanvas Header -->\n  <div class=\"offcanvas-header d-flex justify-content-between\">\n    <h5 class=\"offcanvas-title\" id=\"featuresOffcanvasLabel\">Feature Information</h5>\n    <button type=\"button\" class=\"btn-close text-reset\" data-bs-dismiss=\"offcanvas\" aria-label=\"Close\" @click=\"$store.featureInfoStore.closePanel()\"></button>\n  </div>\n\n  <!-- Layer Selection -->\n  <div class=\"my-3\">\n  <label for=\"layerSelect\">Data found on the following layers:</label>\n  <select class=\"form-select\" x-model=\"$store.featureInfoStore.selectedOption\" x-on:change=\"$store.featureInfoStore.changeSelect($event.target.value)\" :disabled=\"Object.keys($store.featureInfoStore.featuresDict).length == 1\">\n    <template x-for=\"option in Object.keys($store.featureInfoStore.featuresDict)\" :key=\"option\">\n      <option :value=\"option\" x-text=\"option\"></option>\n    </template>\n  </select>\n</div>\n\n\n  <!-- Feature Container -->\n  <div class=\"offcanvas-body featureInfoContainer\">\n    <!-- Navigation Buttons -->\n    <div class=\"text-center my-2\">\n      <button class=\"btn btn-outline-primary btn-sm mx-1\" @click=\"$store.featureInfoStore.showPrevious()\" x-bind:disabled=\"$store.featureInfoStore.currentFeatureIndex == 0\" x-show=\"$store.featureInfoStore.filteredFeatures.length > 1\">Previous</button>\n      <span x-text=\"$store.featureInfoStore.currentFeatureIndex + 1 + ' of ' + $store.featureInfoStore.filteredFeatures.length\" x-show=\"$store.featureInfoStore.filteredFeatures.length > 1\"></span>\n      <button class=\"btn btn-outline-primary btn-sm mx-1\" @click=\"$store.featureInfoStore.showNext()\" x-bind:disabled=\"$store.featureInfoStore.currentFeatureIndex == $store.featureInfoStore.filteredFeatures.length - 1\" x-show=\"$store.featureInfoStore.filteredFeatures.length > 1\">Next</button>\n    </div>\n    \n    <!-- Feature Properties Table -->\n    <template x-if=\"$store.featureInfoStore.filteredFeatures.length > 0\">\n      <table class=\"table table-sm table-striped\">\n        <tbody>\n          <tr>\n            <td></td>\n            <td class=\"text-end\">\n              <button\n                class=\"btn btn-primary btn-sm\"\n                :disabled=\"$store.featureInfoStore.disableButton()\"\n                @click=\"$store.featureInfoStore.addToCompareTool($event)\">add to compare tool</button>\n            </td>\n        </tr>\n          <template x-if=\"$store.featureInfoStore.filteredFeatures[$store.featureInfoStore.currentFeatureIndex]\">\n\n            <template x-for=\"[key, value] in $store.featureInfoStore.getFilteredFeatures()\" :key=\"key\">\n              <template x-if=\"$store.featureInfoStore.filteredFeatures\">\n                    <tr :class=\"key\">\n                      <td><strong x-text=\"$store.featureInfoStore.getKeyTranslation(key)\"></strong></td>\n                      <td><span x-html=\"$store.featureInfoStore.decorateValue(value)\"></span></td>\n                    </tr>\n              </template>\n            </template>\n          </template>\n        </tbody>\n      </table>\n    </template>\n\n    <template x-if=\"$store.featureInfoStore.currentSkullSVG.length > 4\">\n        <div class=\"row w-100\">\n          <div class=\"col-6\" x-html=\"$store.featureInfoStore.svgContent($store.featureInfoStore.currentSkullSVG)\"></div>\n          <div class=\"col-6\">\n          <div class=\"legend col\">\n              <div class=\"rect dark\"></div> bone preservation &gt;75% <br>\n              <div class=\"rect grey\"></div> bone preservation &lt;75% <br>\n              <div class=\"rect pale\"></div> affected <br>\n              <div class=\"rect white\"></div>  unknown / absent <br>\n          </div>\n          </div>\n        </div>\n    </template>\n  </div>\n</div>\n\n  `;\n\n  const mapDIV = document.getElementById('map');\n  mapDIV.insertAdjacentHTML('afterend', featureInfoOffcanvas);\n};\n\n\nconst initialize = () => {\n  Alpine.store('featureInfoStore', {\n    featuresDict: {},\n    filteredFeatures: [],\n    currentFeatureIndex: 0,\n    selectedOption: \"\",\n    showOffCanvas: false,\n    visibleLayers: [],\n    selectedLayers: [],\n    currentSkullSVG: \"\",\n    getFilteredFeatures: function() {\n      if (!this.filteredFeatures[this.currentFeatureIndex]) {\n        return [];\n      }\n\n   \n      const properties = this.filteredFeatures[this.currentFeatureIndex].properties;\n    \n      // Filter out blocked keys and empty values\n      const filteredPropertiesArray = Object.entries(properties).filter(([key, value]) => {\n        return !this.isBlacklistedKey(key) && this.valueIsSet(value);\n      });\n    \n      // Sort the array based on the order in keyTranslations\n      const sortedPropertiesArray = filteredPropertiesArray.sort((a, b) => {\n        const orderA = Object.keys(this.keyTranslations).indexOf(a[0]);\n        const orderB = Object.keys(this.keyTranslations).indexOf(b[0]);\n    \n        if (orderA === -1 && orderB === -1) {\n          return 0;\n        } else if (orderA === -1) {\n          return 1;\n        } else if (orderB === -1) {\n          return -1;\n        } else {\n          return orderA - orderB;\n        }\n      });\n    \n    // Remove 'storage_place' if 'storage_place_freetext' exists and is not empty\n    const storagePlaceFreeTextIndex = sortedPropertiesArray.findIndex(([key,]) => key === \"storage_place_freetext\");\n    if (storagePlaceFreeTextIndex !== -1 && sortedPropertiesArray[storagePlaceFreeTextIndex][1]) {\n      const storagePlaceIndex = sortedPropertiesArray.findIndex(([key,]) => key === \"storage_place\");\n      if (storagePlaceIndex !== -1) {\n        sortedPropertiesArray.splice(storagePlaceIndex, 1);\n      }\n    }\n\n      console.log(\"sorted and filtered properties\", sortedPropertiesArray);\n      return sortedPropertiesArray;\n    },\n    \n    keyTranslations: {\n      \"disease\": \"Disease\",\n      \"sex\": \"Sex\",\n      \"sex_freetext\": \"Methods for sex determination\",\n      \"age\": \"Age\",\n      \"age_estimation_method\": \"Methods for age estimation\",\n      \"age_class\": \"Age class\",\n      \"age_freetext\": \"Estimated age\",\n      \"adults\": \"Adults\",\n      \"size_from\": \"Body height from (cm)\",\n      \"size_to\": \"Body height to (cm)\",\n      \"size_freetext\": \"Methods for body height calculation\",\n      \"chronology\": \"Time period\",\n      \"chronology_freetext\": \"Time period comment\",\n      \"dating_method\": \"Dating method\",\n      \"subadults\": \"Subadults\",\n      \"c_no_o_bones\": \"Amount of bones\",\n      \"c_technic\": \"Used Technic\",\n      \"doi\": \"Doi\",\n      \"dna_analyses\": \"aDNA analyses\",\n      \"dna_analyses_link\": \"DNA analyses\",\n      \"storage_place\": \"Storage place\",\n      \"storage_place_freetext\": \"Storage place freetext\",\n      \"archaeological_burial_type\": \"Archaeological burial type\",\n      \"archaeological_funery_context\": \"Archaeological funerary context\",\n      \"archaeological_individualid\": \"Archaeological individual ID\",\n      \"archaeological_tombid\": \"Archaeological tomb ID\",\n      \"gaz_link\": \"iDAI.gazetteer link\",\n      \"gazid\": \"iDAI.gazetteer ID\",\n      \"site\": \"Site\",\n      \"origin\": \"Origin\",\n      \"reference_images\": \"Reference images\",\n      \"references\": \"References\",\n      \"comment\": \"Comment\",\n      \"c_b_t_bc_rel\": \"Inventory\",\n      \"uuid\": \"UUID\",\n      \"owner\": \"Owner\",\n      \"fid\": \"Datbase ID\",\n    },\n    getKeyTranslation: function(value){\n      const translatedKey = this.keyTranslations[value] || value;\n      return translatedKey\n    },\n    closePanel: function () {\n      this.showOffCanvas = false;\n      emitCustomEvent('deleteMapPins', {})\n    },\n    buildLink: function(value){\n      return buildLink(value)\n    },\n    valueIsSet: function(value){\n      var ret = value !== false && value !== undefined && value !== null &&  value !== \"\";\n      return ret;\n    },\n    decorateValue: function(value) {\n      const decoratedValue = decorateValue(value, \n        ['appendEuroToNumber', \n        'createLinkForUrl', \n        'decodeUrl', \n        'replaceBullet', \n        'harmonizeUnknown', \n        'harmonizeTrueFalse', \n        'harmonizeMonth',\n        'removeListIfOnlyOneLi',\n        'toggleLongText'\n      ]);\n      return decoratedValue;\n    },\n    isBlacklistedKey: function(key) {\n      let blockedKeys = [\n        'svgid', \n        'c_bones', \n        'bone_relations', \n        'age', \n        'adults', \n        'subadults',\n        'c_no_o_bones',\n        'published',\n        'gaz_link',\n        'gazid',\n        'fid',\n        'owner',\n        'is_approved'\n      ]\n      let isNotBlocked = blockedKeys.includes(key)\n      return isNotBlocked;\n    },\n    svgContent: function(value){\n\n      let decoded = decodeURIComponent(value)\n      let json_str = JSON.stringify(decoded);\n      return generateColoredSvg(decoded);\n    },\n    init: function() {\n      this.updateVisibleLayers();\n      this.updateSelectedOption();\n    },\n    updateVisibleLayers: function() {\n      this.visibleLayers = featureLayersGroup.getLayers().getArray().filter(layer => \n        layer.getVisible() && (this.selectedLayers.length === 0 || this.selectedLayers.includes(layer.get('name')))\n      );\n    },\n    updateSelectedOption: function() {\n      this.selectedOption = this.visibleLayers.length > 0 ? this.visibleLayers[0].get('name') : '';\n    },\n    changeSelect: function(value) {\n      this.currentFeatureIndex = 0;\n      this.filteredFeatures = this.featuresDict[value] || [];\n    },\n\n    showNext: function() {\n      if (this.currentFeatureIndex < this.filteredFeatures.length - 1) {\n        this.currentFeatureIndex++;\n        this.updateCurrentSkullSVG();\n      }\n    },\n  \n    showPrevious: function() {\n      if (this.currentFeatureIndex > 0) {\n        this.currentFeatureIndex--;\n        this.updateCurrentSkullSVG();\n      }\n    },\n  \n    updateCurrentSkullSVG: function() {\n      const currentFeature = this.filteredFeatures[this.currentFeatureIndex];\n      if (currentFeature && currentFeature.properties.svgid) {\n        this.currentSkullSVG = currentFeature.properties.svgid;\n      }\n    },\n\n    handleFeatureInfo: function(evt) {\n      emitCustomEvent('showLoading', {});\n      this.resetFeatureInfo();\n    \n      const viewResolution = view.getResolution();\n      let allLayersProcessed = 0;\n      const totalVisibleLayers = this.visibleLayers.length;\n    \n      this.visibleLayers.forEach(layer => this.processLayer(layer, evt.coordinate, viewResolution, () => {\n        allLayersProcessed++;\n        if (allLayersProcessed === totalVisibleLayers) {\n          this.updateAfterProcessing(evt);\n        }\n      }));\n    },\n    resetFeatureInfo: function() {\n      this.featuresDict = {};\n      this.currentFeatureIndex = 0;\n      this.currentSkullSVG = \"\";\n    },\n    processLayer: function(layer, coordinate, resolution, callback) {\n      if (!layer.getVisible()) return;\n  \n      const url = layer.getSource().getFeatureInfoUrl(coordinate, resolution, 'EPSG:3857', \n                                                      { 'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 200 });\n  \n      if (url) {\n        console.warn('making a fetch request in feature info')\n        fetch(url)\n          .then(response => response.json())\n          .then(data => {\n            if (Object.keys(data.features).length > 0) {\n              \n              window.daard_items = data;\n              this.processFeatureData(layer, data);\n              // Set currentSkullSVG for the first feature if it exists\n              if (data.features.length > 0 && data.features[0].properties.svgid) {\n                this.currentSkullSVG = data.features[0].properties.svgid;\n              }\n            }\n            callback();\n          })\n          .catch(error => {\n            console.error('Error:', error);\n            emitCustomEvent('hideLoading', {});\n          });\n      }\n    },\n    processFeatureData: function(layer, data) {\n      const visibleAttributes = layer.get('dataset')['attribute_set']\n                                    .filter(item => item.visible)\n                                    .map(item => item.attribute);\n\n      this.featuresDict[layer.get('name')] = data.features.map(feature => ({\n        ...feature,\n        properties: this.filterFeatureProperties(feature.properties, visibleAttributes)\n      }));\n    },\n    filterFeatureProperties: function(properties, visibleAttributes) {\n      return Object.keys(properties)\n        .filter(key => visibleAttributes.includes(key))\n        .reduce((obj, key) => {\n          obj[key] = properties[key];\n          return obj;\n        }, {});\n    },\n    updateAfterProcessing: function(evt) { // Accept evt as a parameter\n      const firstLayerName = Object.keys(this.featuresDict)[0];\n      if (firstLayerName) {\n        this.filteredFeatures = this.featuresDict[firstLayerName];\n        this.selectedOption = firstLayerName;\n      }\n      emitCustomEvent('hideLoading', {});\n    \n      if (this.isFeaturesDictNotEmpty()) {\n        this.showOffCanvas = true;\n        // addClickIndicator(evt, 3); \n\n        // add pin to vector layer\n        const coordinate = evt.coordinate;\n        const pin_coordinates = [[coordinate[0], coordinate[1]]]\n        emitCustomEvent('deleteMapPins', {})\n        emitCustomEvent('addMapPins', {\"pin_coordinates\": pin_coordinates, \"fitView\": true, moveCenterLeft: true})\n\n\n      } else {\n        console.log(\"The dictionary is empty.\");\n      }\n    },\n    isFeaturesDictNotEmpty: function() {\n      return Object.keys(this.featuresDict).length > 0;\n    },\n    disableButton: function() {\n      const currentUUID = this.filteredFeatures[this.currentFeatureIndex].properties.uuid;\n      const basketItems = Alpine.store('compareTool').items.disease_case;\n\n      let is_uuid_present = basketItems.find(\n        is_uuid_present => is_uuid_present.properties.uuid == currentUUID\n        );\n      is_uuid_present = is_uuid_present ? true : false;\n      return is_uuid_present;\n\n    },\n    addToCompareTool: function(evt) {\n      this.disableButton();\n      // evt.target.disabled = true;\n      const item_uuid = this.filteredFeatures[this.currentFeatureIndex].properties.uuid;\n      // event.target.disabled = true;\n      const disease_case_from_result = Alpine.store(\"compareTool\").find_in_response(\n          window.daard_items,\n          item_uuid\n      );\n      Alpine.store(\"compareTool\").update_disease_case_store(disease_case_from_result);\n  }\n  });\n\n  const domElementsToCreate = [\n    [createFeatureInfoOffCanvasMarkup, '#featureInfoOffcanvas'],\n  ]\n  renderMarkupAndSetPluginReady(domElementsToCreate)\n\n    // Catch the custom event and execute\n    // TODO: Do we need this here?\n    document.addEventListener('mapLayerHaveChanged', function (event) {\n      console.debug('Custom event \"mapLayerHaveChanged\" caught.');\n      Alpine.store('featureInfoStore').init();\n    });\n\n    // Catch the custom event and execute a function\n    // TODO: Do we need this here?\n    document.addEventListener('mapLayerSelected', function (event) {\n      console.debug('Custom event \"mapLayerSelected\" caught.');\n      Alpine.store('featureInfoStore').selectedLayers = event.detail.layer;\n      Alpine.store('featureInfoStore').init();\n    });\n\n    function onMapClick(event) {\n      if(!Alpine.store('pluginStatus').mapClickEnabled){\n        return false;\n      }\n      const handleFeatureInfo = Alpine.store('featureInfoStore').handleFeatureInfo.bind(Alpine.store('featureInfoStore'));\n      handleFeatureInfo(event);\n  }\n  \n  Alpine.nextTick(() => {\n      map.on('singleclick', onMapClick);\n  });\n  \n\n}\n\n\nexport { initialize };\n"],"names":["createFeatureInfoOffCanvasMarkup","featureInfoOffcanvas","initialize","Alpine","properties","sortedPropertiesArray","key","value","b","orderA","orderB","storagePlaceFreeTextIndex","storagePlaceIndex","emitCustomEvent","buildLink","ret","decorateValue","decoded","generateColoredSvg","featureLayersGroup","layer","currentFeature","evt","viewResolution","view","allLayersProcessed","totalVisibleLayers","coordinate","resolution","callback","url","response","data","error","visibleAttributes","item","feature","obj","firstLayerName","pin_coordinates","currentUUID","is_uuid_present","item_uuid","disease_case_from_result","renderMarkupAndSetPluginReady","event","onMapClick","map"],"mappings":"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"}